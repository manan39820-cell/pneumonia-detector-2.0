<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="8p_v_sw2-gTR7N-ySCK0svPSqHE6bJ8eOXqPbCLLhbI" />>
    <title>Pediatric Pneumonia Detection - Chest X-Ray Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background-color: #f8f9fa;
        }

        .upload-area.dragover {
            border-color: #27ae60;
            background-color: #d5f4e6;
        }

        #imageInput {
            display: none;
        }

        .upload-btn {
            background: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .upload-btn:hover {
            background: #2980b9;
        }

        .preview-container {
            margin: 20px 0;
            text-align: center;
        }

        #imagePreview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .analyze-btn {
            background: #27ae60;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s ease;
        }

        .analyze-btn:hover {
            background: #229954;
        }

        .analyze-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .results-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-card {
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }

        .result-normal {
            background: #d5f4e6;
            border-left: 5px solid #27ae60;
        }

        .result-pneumonia {
            background: #fadbd8;
            border-left: 5px solid #e74c3c;
        }

        .confidence-bar {
            background: #ecf0f1;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }

        .info-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .emergency-section {
            background: #e74c3c;
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .emergency-section h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .emergency-contacts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .contact-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .disclaimer {
            background: #f39c12;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .emergency-contacts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü´Å Pediatric Pneumonia Detection</h1>
            <p>AI-Powered Chest X-Ray Analysis for Children (Ages 1-5)</p>
        </div>

        <div class="disclaimer">
            <h3>‚ö†Ô∏è Medical Disclaimer</h3>
            <p>This tool is for educational purposes only and should NOT replace professional medical diagnosis. Always consult with a qualified healthcare provider for medical advice.</p>
        </div>

<div class="info-section"> 
          <div class="info-card" style="border-left: 5px solid #e67e22;">
             <h3>üìã X-Ray Image Requirements</h3>
             <p><strong>Important:</strong> The X-ray image must be clean and unmodified for accurate analysis.</p>
 <ul style="text-align: left; margin-top: 10px;"> 
<li><strong>No annotations:</strong> 
Remove any text, arrows, markers, or medical annotations</li> 
<li><strong>Original format:</strong> Use the raw X-ray image without any overlays or modifications</li> 
<li><strong>Clear quality:</strong> Ensure the image is not blurry, cropped, or distorted</li> 
<li><strong>Proper orientation:</strong> X-ray should be in standard anatomical position</li> 
<li><strong>Single view:</strong> Upload one chest X-ray view at a time (PA or AP preferred)</li> 
</ul> 
<p style="margin-top: 15px; font-style: italic; color: #7f8c8d;"> 
Any markings, measurements, or annotations on the X-ray may interfere with the AI analysis and lead to inaccurate results. 
          </p> 
         </div>
¬†¬†¬†¬†¬†¬†¬†¬†</div>

        <div class="main-content">
            <div class="upload-section">
                <h2>üì§ Upload Chest X-Ray</h2>
                <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                    <p>Click here or drag and drop a chest X-ray image</p>
                    <p style="font-size: 0.9em; color: #7f8c8d; margin-top: 10px;">Supported formats: JPG, PNG, GIF</p>
                </div>
                <input type="file" id="imageInput" accept="image/*">
                
                <div class="preview-container" id="previewContainer" style="display: none;">
                    <img id="imagePreview" alt="X-ray preview">
                </div>
                
                <button class="analyze-btn" id="analyzeBtn" disabled onclick="analyzeImage()">
                    üîç Analyze X-Ray
                </button>
            </div>

            <div class="results-section">
                <h2>üìä Analysis Results</h2>
                <div id="resultsContent">
                    <p style="text-align: center; color: #7f8c8d; padding: 40px;">
                        Upload an X-ray image to see analysis results
                    </p>
                </div>
            </div>
        </div>

        <div class="emergency-section">
            <h2>üö® Emergency Contacts</h2>
            <p>If you suspect pneumonia, seek immediate medical attention!</p>
            <div class="emergency-contacts">
                <div class="contact-card">
                    <h3>Emergency Services</h3>
                    <p><strong>Call: 911</strong></p>
                    <p>For immediate life-threatening situations</p>
                </div>
                <div class="contact-card">
                    <h3>Pediatric Emergency</h3>
                    <p><strong>Call: (555) 123-KIDS</strong></p>
                    <p>24/7 Children's Hospital Hotline</p>
                </div>
                <div class="contact-card">
                    <h3>Poison Control</h3>
                    <p><strong>Call: 1-800-222-1222</strong></p>
                    <p>For medication-related emergencies</p>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h2>üìö About Pneumonia in Children</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>What is Pneumonia?</h3>
                    <p>Pneumonia is an infection that inflames air sacs in one or both lungs. In children aged 1-5, it can be particularly serious as their immune systems are still developing. The air sacs may fill with fluid or pus, causing cough with phlegm, fever, chills, and difficulty breathing.</p>
                </div>
                
                <div class="info-card">
                    <h3>Common Symptoms</h3>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li>Persistent cough with thick mucus</li>
                        <li>High fever (over 101¬∞F/38.3¬∞C)</li>
                        <li>Rapid or difficult breathing</li>
                        <li>Chest pain when breathing or coughing</li>
                        <li>Loss of appetite and fatigue</li>
                        <li>Bluish lips or fingernails</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>Harmful Effects</h3>
                    <p><strong>Immediate Risks:</strong> Severe breathing difficulties, dehydration, and high fever can be life-threatening in young children.</p>
                    <p><strong>Complications:</strong> Untreated pneumonia can lead to lung abscesses, pleural effusion, sepsis, and respiratory failure.</p>
                    <p><strong>Long-term Impact:</strong> Severe cases may cause permanent lung damage affecting breathing capacity.</p>
                </div>
                
                <div class="info-card">
                    <h3>When to Seek Help</h3>
                    <p><strong>Immediate Emergency:</strong> Difficulty breathing, blue lips/skin, high fever with lethargy, or severe chest pain.</p>
                    <p><strong>Urgent Care:</strong> Persistent cough for more than 3 days, fever over 102¬∞F, or worsening symptoms.</p>
                    <p><strong>Prevention:</strong> Ensure vaccinations are up-to-date, practice good hygiene, and avoid exposure to smoke.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let model;
        const modelURL = './model/model.json';
        const metadataURL = './model/metadata.json';

        // Initialize the model when page loads
        async function initModel() {
            try {
                console.log('Loading model...');
                model = await tmImage.load(modelURL, metadataURL);
                console.log('Model loaded successfully');
            } catch (error) {
                console.error('Error loading model:', error);
                document.getElementById('resultsContent').innerHTML = `
                    <div style="text-align: center; color: #e74c3c; padding: 20px;">
                        <h3>‚ö†Ô∏è Model Loading Error</h3>
                        <p>Please ensure the model files are in the './model/' folder:</p>
                        <ul style="text-align: left; margin-top: 10px;">
                            <li>model.json</li>
                            <li>model_metadata.json (rename to metadata.json)</li>
                            <li>weights.bin</li>
                        </ul>
                        <p style="margin-top: 15px;">Download these files from your Teachable Machine project.</p>
                    </div>
                `;
            }
        }

        // File upload handling
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewContainer = document.getElementById('previewContainer');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const uploadArea = document.querySelector('.upload-area');

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files[0]);
            }
        });

        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
            }
        });

        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload a valid image file.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                previewContainer.style.display = 'block';
                analyzeBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        async function analyzeImage() {
            if (!model) {
                alert('Model is not loaded yet. Please wait and try again.');
                return;
            }

            const resultsContent = document.getElementById('resultsContent');
            
            // Show loading state
            resultsContent.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing chest X-ray...</p>
                    <p style="font-size: 0.9em; color: #7f8c8d;">This may take a few moments</p>
                </div>
            `;

            try {
                // Make prediction
                const predictions = await model.predict(imagePreview);
                displayResults(predictions);
            } catch (error) {
                console.error('Prediction error:', error);
                resultsContent.innerHTML = `
                    <div style="text-align: center; color: #e74c3c; padding: 20px;">
                        <h3>‚ùå Analysis Error</h3>
                        <p>There was an error analyzing the image. Please try again with a different image.</p>
                    </div>
                `;
            }
        }

        function displayResults(predictions) {
            const resultsContent = document.getElementById('resultsContent');
            
            // Find the highest confidence prediction
            let maxPrediction = predictions[0];
            for (let i = 1; i < predictions.length; i++) {
                if (predictions[i].probability > maxPrediction.probability) {
                    maxPrediction = predictions[i];
                }
            }

            const confidence = (maxPrediction.probability * 100).toFixed(1);
            
            let resultHTML = `
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h4>üìä Detailed Analysis:</h4>
            `;
            
            predictions.forEach(prediction => {
                const prob = (prediction.probability * 100).toFixed(1);
                resultHTML += `
                    <div style="margin: 5px 0; display: flex; justify-content: space-between; align-items: center;">
                        <span>${prediction.className}:</span>
                        <span><strong>${prob}%</strong></span>
                    </div>
                `;
            });
            
            resultHTML += `</div>`;

            resultsContent.innerHTML = resultHTML;
        }

        // Initialize model when page loads
        window.addEventListener('load', initModel);
    </script>
</body>
</html>
